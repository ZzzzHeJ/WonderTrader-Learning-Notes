---
sort: 2
---

# 解决方案

发现问题后自然就是要解决问题，先不要去看源码，让我们来看看WT的设计架构

## 架构分析

为了应对不同的交易情景，WT提供了多套交易引擎，这里以CTA引擎的架构为例进行讲解。

![png](../assets/images/3.思路分析/CTA架构.png)

我将上述架构图中的成员其分为以下几类：

- **回调函数** 如on_tick, on_bar, on_shedule等
- **外部环境** 如交易柜台，行情源
- **通道** Parser、Traders
- **管理器** CTATicker, CTAEngine, Executer

下面我将分别介绍这些成员，以及WT是如何利用这些成员及其之间的配合解决问题的。

我们可以看到许多熟悉字眼，如on_tick、on_bar等会到时间

## 将信号与交易解耦

仔细思考，我们会发现相较于信号的千变万化，交易中遇到的问题往往是固定的几类，只是不同的人有不同的解法。策略仅负责计算和发出信号，交易交给统一的执行者去处理，这样便能够大大降低策略开发者的负担，提高策略开发的效率。而且统一的信号执行流程，不仅能够降低重复开发工作，而且能够避免许多不必要的问题。

WT将交易中的换月、开平锁、轧平等问题统统内置，以CTA引擎的架构为例，WT将这些繁琐的交易细节交给Executer处理。WT将策略信号总结为多头进场、空头进场、多头出场、空头出场四种。策略生成信号，交由CTAEngine汇总后传给Executer处理。Executer的主要工作就是根据当前持仓、风控设置、合约特性等信息，将各种信号转换为具体的交易指令最后传达给交易通道。

通过上述处理，WT不仅将信号与交易分离，策略仅处理信号部分，而且还将信号简化为四种，策略开发者不需要考虑不同合约在交易上的不同，降低了开发难度。




这些问题让策略开发者头痛不已，无法专注于信号或算法的研究，反而需要投入大量的精力去考虑交易的细节，往往还无法处理的很好。其实仔细思考，我们会发现，相较于信号的千变万化，交易中遇到的问题往往是固定的几类，只是不同的人有不同的解法。如果能够将信号与交易分离，策略仅负责计算和发出信号，交易交给统一的执行者去处理，这样便能够大大降低策略开发者的负担，提高策略开发的效率。而且统一的信号执行流程，不仅能够降低重复开发工作，而且能够避免许多不必要的问题。

因此，将信号与交易解耦，是设计WonderTrader的重要目的之一。
首先，一个完整的量化策略可以分为两个部分，一部分是***信号***，另一部分是`交易`。

信号由策略计算产生，再由系统执行交易。以一个简单的双均线策略为例，策略通过不停的计算均线值，并判断长均线和短均线的相对位置来生成交易信号，这一部分就是策略的信号部分。当信号出现时，策略发出交易指令，进行下单，这是交易部分。但实际情况中，信号的生成往往较简单，但交易的执行却复杂的多。因为交易不仅包括下单，还包括如何下单，比如股票中的T+1限制，期货里面的今昨仓；订单的管理，超时未成交是否撤单，撤单后是否追单等等；一个账户下的多个策略对同一个合约下单，如何避免自成交。这些问题都会导致策略中交易部分的代码量迅速膨胀爆炸。

这些问题让策略开发者头痛不已，无法专注于信号或算法的研究，反而需要投入大量的精力去考虑交易的细节，往往还无法处理的很好。其实仔细思考，我们会发现，相较于信号的千变万化，交易中遇到的问题往往是固定的几类，只是不同的人有不同的解法。如果能够将信号与交易分离，策略仅负责计算和发出信号，交易交给统一的执行者去处理，这样便能够大大降低策略开发者的负担，提高策略开发的效率。而且统一的信号执行流程，不仅能够降低重复开发工作，而且能够避免许多不必要的问题。

因此，将信号与交易解耦，是设计WonderTrader的重要目的之一。

## 策略组

作为个人投资者，往往仅管理一个账户，三个左右的策略，管理的压力较少。但对于机构投资者，需要同时管理多个产品，每个产品可能包含几十个策略，而且多个策略可能还在同一个账户，甚至同一个合约上运行。这就会造成特别大策略管理压力，要求每个策略不仅能够单独记账，不影响同账户下的其他策略，而且要求还需要一个强大的控制台模块，来管理策略的组合。

## 研究实盘一致

这里的一致并不是指绩效一致（这几乎无法达成），而是指回测和实盘的代码一致，可以保证策略可以无缝在回测环境和实盘环境之间切换。这几乎已经成为了所有量化交易系统的基本要求。
